let mensagemWhatsApp = "";

const TAXA_MINIMA = 5.00;
const LIMITE_KM = 15;
const TAXA_EXTRA_POR_KM = 0.50;

// Carregar valor salvo
let valorPorKm = Number(localStorage.getItem("valorKm")) || 1.90;

function calcularFrete() {
  const km = Number(document.getElementById("km").value);
  if (!km || km <= 0) {
    alert("Informe a quilometragem");
    return;
  }

  let valorIda = km * valorPorKm;
  let taxaExtra = 0;
  let aviso = "";

  if (km > LIMITE_KM) {
    taxaExtra = (km / 2) * TAXA_EXTRA_POR_KM;
    aviso = "üö® Taxa adicional aplicada (dist√¢ncia acima de 15 km)";
  }

  let total = valorIda + taxaExtra;

  if (total < TAXA_MINIMA) {
    total = TAXA_MINIMA;
    aviso = "‚ö†Ô∏è Aplicada taxa m√≠nima";
  }

  const f = v => v.toFixed(2).replace(".", ",");

  mensagemWhatsApp =
`Ol√° üòä

O valor do seu frete ficou em *R$ ${f(total)}* üõµ

üìç Dist√¢ncia: ${km} km
üí∞ Valor da ida: R$ ${f(valorIda)}
‚ûï Taxa adicional: R$ ${f(taxaExtra)}

${aviso}
Qualquer d√∫vida fico √† disposi√ß√£o.`;

  document.getElementById("resultado").innerHTML = `
    <div class="linha">üí∞ <strong>Ida:</strong> R$ ${f(valorIda)}</div>
    <div class="linha">‚ûï <strong>Taxa extra:</strong> R$ ${f(taxaExtra)}</div>
    <div class="linha"><strong>‚úÖ Total:</strong> R$ ${f(total)}</div>
    ${aviso ? `<div class="linha">${aviso}</div>` : ""}
  `;
}

function abrirWhatsApp() {
  if (!mensagemWhatsApp) {
    alert("Calcule o frete primeiro");
    return;
  }
  const texto = encodeURIComponent(mensagemWhatsApp);
  window.open(`https://wa.me/?text=${texto}`, "_blank");
}

/* CONFIGURA√á√ïES */
function abrirConfig() {
  document.getElementById("modalConfig").style.display = "flex";
  document.getElementById("valorKm").value = valorPorKm;
}

function fecharConfig() {
  document.getElementById("modalConfig").style.display = "none";
}

function salvarConfig() {
  valorPorKm = Number(document.getElementById("valorKm").value);
  localStorage.setItem("valorKm", valorPorKm);
  alert("Configura√ß√£o salva ‚úÖ");
  fecharConfig();
}
